<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Raheem AI | Construction Compliance Intelligence</title>

  <style>
    /* -----------------------------------
      RAHEEM AI — NEW LAYOUT (SELLABLE)
      - spacious, premium, clear
      - visible movement (aurora + particles)
      - keep all existing functions
      - hide saved chats unless in Chat view
    ----------------------------------- */

    :root{
      --bg0:#050610;
      --bg1:#070a18;
      --bg2:#0a0f22;

      --panel: rgba(255,255,255,.07);
      --panel2: rgba(255,255,255,.10);
      --stroke: rgba(255,255,255,.12);
      --stroke2: rgba(255,255,255,.18);

      --text:#f3f7ff;
      --muted: rgba(243,247,255,.78);
      --muted2: rgba(243,247,255,.60);

      /* Brighter brand accents */
      --a1:#55f7d6; /* neon mint */
      --a2:#6cb6ff; /* bright blue */
      --a3:#b99bff; /* violet */

      --ok:#22c55e;
      --warn:#f59e0b;

      --shadow: 0 26px 70px rgba(0,0,0,.58);
      --shadow2: 0 16px 44px rgba(0,0,0,.40);

      --r:22px;
      --r2:16px;

      --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      background: linear-gradient(180deg, var(--bg0), var(--bg1) 35%, var(--bg2));
      overflow-x:hidden;
    }

    /* ---------- Motion background ---------- */
    .bg-wrap{
      position:fixed;
      inset:0;
      z-index:0;
      pointer-events:none;
      overflow:hidden;
    }

    /* animated aurora */
    .aurora{
      position:absolute;
      inset:-20%;
      background:
        radial-gradient(900px 520px at 15% 20%, rgba(85,247,214,.18) 0%, rgba(85,247,214,0) 65%),
        radial-gradient(900px 520px at 85% 18%, rgba(108,182,255,.18) 0%, rgba(108,182,255,0) 62%),
        radial-gradient(980px 560px at 55% 105%, rgba(185,155,255,.16) 0%, rgba(185,155,255,0) 60%);
      filter: blur(18px);
      opacity:.95;
      transform: translate3d(0,0,0);
      animation: auroraMove 14s ease-in-out infinite;
    }
    @keyframes auroraMove{
      0%,100%{ transform: translate3d(0,0,0) scale(1); }
      40%{ transform: translate3d(18px,-14px,0) scale(1.02); }
      70%{ transform: translate3d(-16px,12px,0) scale(1.03); }
    }

    /* subtle grid */
    .grid{
      position:absolute;
      inset:0;
      opacity:.08;
      background-image:
        linear-gradient(to right, rgba(255,255,255,.16) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.10) 1px, transparent 1px);
      background-size: 76px 76px;
      mask-image: radial-gradient(circle at 30% 15%, rgba(0,0,0,1), rgba(0,0,0,0) 70%);
      animation: gridDrift 24s linear infinite;
    }
    @keyframes gridDrift{
      0%{ background-position: 0 0, 0 0; }
      100%{ background-position: 220px 140px, 140px 220px; }
    }

    /* particles */
    canvas#particles{
      position:absolute;
      inset:0;
      opacity:.55;
      filter: blur(.1px);
    }

    /* ---------- Layout ---------- */
    .app{
      position:relative;
      z-index:1;
      min-height:100vh;
      padding: 22px;
      display:grid;
      grid-template-columns: 360px 1fr;
      gap: 18px;
      align-items:start;
      max-width: 1320px;
      margin: 0 auto;
    }

    @media (max-width: 1080px){
      .app{
        grid-template-columns: 1fr;
        padding: 16px;
      }
      .sidebar{ position: relative; }
    }

    /* Sidebar (brand + controls) */
    .sidebar{
      border:1px solid var(--stroke);
      background: var(--panel);
      border-radius: var(--r);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(14px);
      overflow:hidden;
    }

    .brand{
      padding: 18px 18px 14px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      display:flex;
      gap: 12px;
      align-items:center;
    }

    .logo{
      width: 54px;
      height: 54px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.16);
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.18), rgba(255,255,255,0) 60%),
        linear-gradient(135deg, rgba(85,247,214,.95), rgba(108,182,255,.95));
      box-shadow: 0 18px 40px rgba(85,247,214,.18);
      display:flex;
      align-items:center;
      justify-content:center;
      flex:0 0 auto;
    }
    .logo svg{ width: 32px; height: 32px; }

    .brand-meta{
      display:flex;
      flex-direction:column;
      gap: 4px;
      min-width: 0;
    }
    .brand-meta strong{
      font-size: 16px;
      letter-spacing:.2px;
      font-weight: 950;
      line-height:1.1;
    }
    .brand-meta span{
      font-size: 12px;
      color: var(--muted);
      line-height:1.35;
    }

    .nav{
      display:flex;
      gap: 10px;
      padding: 14px 18px;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }

    .tab{
      flex:1;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 11px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 950;
      font-size: 13px;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
    }
    .tab:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.10);
      border-color: rgba(108,182,255,.25);
    }
    .tab.active{
      background: linear-gradient(135deg, rgba(85,247,214,.95), rgba(108,182,255,.95));
      border-color: rgba(85,247,214,.30);
      color: #041017;
    }

    .block{
      padding: 16px 18px;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .block:last-child{ border-bottom:none; }

    .block-title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .block-title b{
      font-size: 12px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: rgba(243,247,255,.86);
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-weight: 950;
      font-size: 12px;
      color: rgba(243,247,255,.82);
      white-space: nowrap;
      user-select:none;
    }
    .pill.live{
      border-color: rgba(34,197,94,.36);
      background: rgba(34,197,94,.10);
      color: #d9ffe9;
    }
    .pill.brand{
      border-color: rgba(85,247,214,.26);
      background: rgba(85,247,214,.08);
      color: rgba(230,255,250,.95);
    }

    .row{ margin-top: 10px; }
    label{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      font-size: 12px;
      color: rgba(243,247,255,.84);
      font-weight: 900;
      margin-bottom: 6px;
    }

    input, select{
      width:100%;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(2,5,12,.78);
      color: var(--text);
      padding: 11px 12px;
      font-size: 13px;
      font-weight: 750;
      outline:none;
    }
    select option{ background:#0b1222; color:#f3f7ff; }
    input:focus, select:focus{
      outline: 3px solid rgba(108,182,255,.22);
      outline-offset: 2px;
    }

    .status{
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content:space-between;
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
    }
    .mini{
      display:flex;
      gap: 10px;
      align-items:center;
      color: rgba(243,247,255,.76);
      font-weight: 900;
      font-size: 12px;
    }
    .dot{
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(243,247,255,.40);
    }
    .ok .dot{ background: var(--ok); box-shadow: 0 0 0 5px rgba(34,197,94,.12); }
    .warn .dot{ background: var(--warn); box-shadow: 0 0 0 5px rgba(245,158,11,.12); }

    .hint{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(243,247,255,.66);
      line-height: 1.5;
    }

    /* Hide history panel unless in chat view */
    .history-panel{ display:none; }
    body.is-chat .history-panel{ display:block; }

    .history-list{
      display:flex;
      flex-direction:column;
      gap: 8px;
      max-height: 260px;
      overflow:auto;
      padding-right: 4px;
    }
    .history-item{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(2,5,12,.55);
      border-radius: 16px;
      padding: 10px 10px;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .history-item:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.08);
      border-color: rgba(108,182,255,.24);
    }
    .history-item.active{
      border-color: rgba(85,247,214,.30);
      background: rgba(255,255,255,.10);
    }
    .history-row{
      display:flex;
      justify-content:space-between;
      gap: 10px;
      align-items:flex-start;
    }
    .history-name{
      font-weight: 950;
      font-size: 12px;
      color: rgba(243,247,255,.92);
      line-height: 1.25;
    }
    .history-meta{
      font-size: 11px;
      color: rgba(243,247,255,.60);
      white-space:nowrap;
    }
    .history-preview{
      margin-top: 6px;
      font-size: 12px;
      color: rgba(243,247,255,.72);
      line-height: 1.35;
      display:-webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow:hidden;
    }
    .history-controls{
      margin-top: 10px;
      display:flex;
      gap: 8px;
    }
    .history-btn{
      flex:1;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(243,247,255,.88);
      padding: 8px 10px;
      border-radius: 12px;
      font-weight: 950;
      font-size: 12px;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .history-btn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.10);
      border-color: rgba(108,182,255,.22);
    }

    .btn-mini{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 12px;
      font-weight: 950;
      font-size: 12px;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .btn-mini:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.10);
      border-color: rgba(108,182,255,.22);
    }

    /* Content area */
    .content{
      border:1px solid var(--stroke);
      background: var(--panel);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      overflow:hidden;
    }

    .content-inner{ padding: 18px; }

    .hero{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      border-radius: var(--r);
      padding: 18px;
      box-shadow: 0 1px 0 rgba(255,255,255,.03);
    }

    .hero h2{
      margin:0;
      font-size: 18px;
      letter-spacing:.2px;
      font-weight: 980;
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap: wrap;
    }

    .hero p{
      margin: 10px 0 0;
      color: rgba(243,247,255,.74);
      font-size: 13px;
      line-height: 1.55;
      max-width: 80ch;
    }

    .quote{
      margin-top: 12px;
      padding: 12px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(2,5,12,.55);
      color: rgba(243,247,255,.80);
      font-weight: 800;
      font-size: 12px;
      line-height: 1.5;
    }

    .top-row{
      display:grid;
      grid-template-columns: 1fr 340px;
      gap: 16px;
      align-items:start;
      margin-top: 16px;
    }
    @media (max-width: 980px){
      .top-row{ grid-template-columns: 1fr; }
    }

    .auth-top{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      border-radius: var(--r);
      padding: 16px;
      box-shadow: 0 1px 0 rgba(255,255,255,.03);
    }
    .auth-title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .auth-title span:first-child{
      font-weight: 980;
      font-size: 14px;
    }

    .btn{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 11px 12px;
      border-radius: 14px;
      font-weight: 950;
      font-size: 13px;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease, box-shadow .12s ease;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
      user-select:none;
      width:100%;
    }
    .btn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.10);
      border-color: rgba(108,182,255,.22);
      box-shadow: 0 12px 26px rgba(0,0,0,.22);
    }
    .btn.primary{
      background: linear-gradient(135deg, rgba(85,247,214,.95), rgba(108,182,255,.95));
      border-color: rgba(85,247,214,.26);
      color: #041017;
      width:auto;
    }
    .btn.small{
      padding: 10px 12px;
      width:100%;
    }

    .auth-hint{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(243,247,255,.68);
      line-height:1.45;
    }

    .section-title{
      margin: 18px 2px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .section-title h3{
      margin:0;
      font-size: 13px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: rgba(243,247,255,.86);
      font-weight: 980;
    }

    .grid-cards{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 14px;
    }
    @media (max-width: 980px){
      .grid-cards{ grid-template-columns: 1fr; }
    }

    .card{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      border-radius: var(--r);
      padding: 16px;
      box-shadow: 0 1px 0 rgba(255,255,255,.03);
      transition: transform .14s ease, background .14s ease, border-color .14s ease, box-shadow .14s ease;
      cursor:pointer;
      min-height: 170px;
      position:relative;
      overflow:hidden;
    }
    .card:hover{
      transform: translateY(-2px);
      border-color: rgba(108,182,255,.26);
      background: rgba(255,255,255,.09);
      box-shadow: var(--shadow2);
    }
    .card::after{
      content:"";
      position:absolute;
      width: 320px; height: 320px;
      border-radius: 999px;
      top:-190px; right:-190px;
      background: radial-gradient(circle, rgba(85,247,214,.14), rgba(85,247,214,0) 66%);
      pointer-events:none;
    }

    .card-head{
      display:flex;
      justify-content:space-between;
      gap: 12px;
      align-items:flex-start;
    }

    .card-title{
      display:flex;
      gap: 12px;
      align-items:flex-start;
      min-width:0;
    }

    .icon{
      width: 44px;
      height: 44px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(135deg, rgba(108,182,255,.95), rgba(85,247,214,.95));
      display:flex;
      align-items:center;
      justify-content:center;
      color:#041017;
      font-weight: 980;
      flex:0 0 auto;
      box-shadow: 0 16px 30px rgba(0,0,0,.30);
    }

    .card-title h4{
      margin: 0;
      font-size: 15px;
      font-weight: 980;
      letter-spacing:.2px;
    }
    .card-title p{
      margin: 6px 0 0;
      font-size: 12.5px;
      color: rgba(243,247,255,.72);
      line-height: 1.45;
      max-width: 70ch;
    }

    .cta{
      margin-top: 14px;
      display:flex;
      justify-content:space-between;
      gap: 10px;
      align-items:center;
      flex-wrap: wrap;
    }

    .footer{
      margin-top: 18px;
      padding: 14px 4px 0;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      color: rgba(243,247,255,.62);
      font-size: 12px;
      flex-wrap: wrap;
    }
    .footer-left{
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .sep{
      width: 6px;
      height: 6px;
      border-radius: 99px;
      background: rgba(85,247,214,.35);
      box-shadow: 0 0 0 4px rgba(85,247,214,.12);
    }

    /* Views */
    .view{ display:none; }
    .view.active{ display:block; }

    /* Chat */
    .chat-shell{
      border-radius: var(--r);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      overflow:hidden;
      box-shadow: var(--shadow2);
    }

    .chat-top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 12px;
      padding: 14px 14px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(2,5,12,.55);
      backdrop-filter: blur(12px);
    }
    .chat-top strong{ font-size: 14px; }
    .chat-top span{ font-size: 12px; color: rgba(243,247,255,.72); }

    .chat-help{
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .chip{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 9px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 950;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
    }
    .chip:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.10);
      border-color: rgba(108,182,255,.22);
    }

    .chat-log{
      height: 62vh;
      overflow-y:auto;
      padding: 14px;
      background:
        radial-gradient(900px 480px at 20% 0%, rgba(108,182,255,.12), rgba(108,182,255,0) 62%),
        radial-gradient(900px 480px at 90% 10%, rgba(85,247,214,.10), rgba(85,247,214,0) 55%),
        rgba(0,0,0,.10);
    }

    .msg{ display:flex; margin-bottom: 12px; }
    .msg.user{ justify-content:flex-end; }

    .bubble{
      max-width: min(820px, 92%);
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      box-shadow: 0 1px 0 rgba(255,255,255,.03);
      font-size: 13px;
      line-height: 1.55;
      white-space: pre-wrap;
    }
    .msg.user .bubble{
      background: linear-gradient(135deg, rgba(85,247,214,.95), rgba(108,182,255,.95));
      border-color: rgba(85,247,214,.20);
      color: #041017;
      font-weight: 760;
    }

    .meta{
      font-size: 11px;
      color: rgba(243,247,255,.55);
      margin-top: 6px;
    }
    .msg.user .meta{ text-align:right; }

    .typing{
      display:inline-flex;
      align-items:center;
      gap: 6px;
      color: rgba(243,247,255,.72);
      font-weight: 800;
    }
    .dots{
      display:inline-flex;
      gap: 4px;
      transform: translateY(1px);
    }
    .dots span{
      width: 6px; height: 6px;
      border-radius: 99px;
      background: rgba(243,247,255,.42);
      animation: dot 1.2s infinite ease-in-out;
    }
    .dots span:nth-child(2){ animation-delay: .15s; }
    .dots span:nth-child(3){ animation-delay: .30s; }
    @keyframes dot{
      0%,100%{ opacity:.35; transform: translateY(0); }
      50%{ opacity:1; transform: translateY(-2px); }
    }

    .chat-input{
      display:flex;
      gap: 10px;
      align-items:flex-end;
      padding: 12px;
      border-top: 1px solid rgba(255,255,255,.10);
      background: rgba(2,5,12,.60);
      backdrop-filter: blur(12px);
      position: sticky;
      bottom: 0;
    }
    textarea{
      width:100%;
      min-height: 46px;
      max-height: 160px;
      resize:none;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(2,5,12,.78);
      color: var(--text);
      font-family: var(--font);
      font-size: 13px;
      padding: 10px 12px;
      line-height: 1.35;
    }
    textarea::placeholder{ color: rgba(243,247,255,.55); }
    textarea:focus{ outline: 3px solid rgba(108,182,255,.22); outline-offset: 2px; }
  </style>
</head>

<body>
  <div class="bg-wrap" aria-hidden="true">
    <div class="aurora"></div>
    <div class="grid"></div>
    <canvas id="particles"></canvas>
  </div>

  <div class="app">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <div class="logo" aria-label="Raheem AI logo">
          <!-- same logo SVG you had -->
          <svg viewBox="0 0 48 48" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
            <rect x="7" y="7" width="34" height="34" rx="7" stroke="rgba(255,255,255,.92)" stroke-width="2"/>
            <path d="M15 16H30V30H22.5C18.9 30 16 27.1 16 23.5V16Z" stroke="rgba(255,255,255,.88)" stroke-width="2"/>
            <path d="M22.5 30V35" stroke="rgba(255,255,255,.88)" stroke-width="2" stroke-linecap="round"/>
            <path d="M13 24H20" stroke="rgba(255,255,255,.40)" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M13 20H20" stroke="rgba(255,255,255,.40)" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M13 28H20" stroke="rgba(255,255,255,.40)" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M30.5 19.5L34 23" stroke="rgba(255,255,255,.96)" stroke-width="2.6" stroke-linecap="round"/>
            <path d="M34 23L40 17" stroke="rgba(255,255,255,.96)" stroke-width="2.6" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="brand-meta">
          <strong>Raheem AI</strong>
          <span>Talk normally. When it becomes a compliance question, it switches automatically.</span>
        </div>
      </div>

      <div class="nav">
        <button class="tab active" id="navDashboard" type="button">Home</button>
        <button class="tab" id="navChat" type="button">Chat</button>
        <button class="tab" id="navFuture" type="button">Future</button>
      </div>

      <div class="block">
        <div class="block-title">
          <b>Guidance</b>
          <span class="pill brand" id="pdfCount">Docs 0</span>
        </div>

        <div class="row">
          <label for="pdfSearch">Search documents <span class="pill" id="syncInline">sync</span></label>
          <input id="pdfSearch" type="text" placeholder="Type to filter document names" />
        </div>

        <div class="row">
          <label for="pdfSelect">Force a document <span class="pill brand" id="chipDoc">Auto mode</span></label>
          <select id="pdfSelect">
            <option value="">Auto mode</option>
          </select>
        </div>

        <div class="status" id="serviceStatusWrap">
          <div class="mini warn" id="serviceStatus"><span class="dot"></span>Connecting</div>
          <div class="pill" id="lastSync">Updated</div>
        </div>

        <div class="hint">
          Auto mode is recommended. Use “Force a document” only when you want to pin a source.
        </div>
      </div>

      <div class="block history-panel" id="historyPanel">
        <div class="block-title">
          <b>Saved chats</b>
          <div style="display:flex;gap:8px">
            <button class="btn-mini" type="button" id="btnNewChat">New</button>
            <button class="btn-mini" type="button" id="btnClearChats">Clear</button>
          </div>
        </div>
        <div class="history-list" id="historyList"></div>
        <div class="hint">Chats are stored locally in your browser.</div>
      </div>
    </aside>

    <!-- CONTENT -->
    <main class="content">
      <div class="content-inner">
        <!-- DASHBOARD -->
        <section id="view-dashboard" class="view active">
          <div class="top-row">
            <div class="hero">
              <h2>Raheem AI <span class="pill brand">2026</span> <span class="pill live">Live</span></h2>
              <p>
                A calm, professional assistant for Irish building regulation guidance.
                Ask in plain language. It will select the right guidance and answer with clear support.
              </p>
              <div class="quote">
                Good compliance starts early. The best time to catch a problem is before it becomes a drawing.
              </div>
            </div>

            <div class="auth-top">
              <div class="auth-title">
                <span>Sign in</span>
                <span class="pill brand">Coming</span>
              </div>
              <button class="btn small" type="button">Continue with Google</button>
              <div class="auth-hint">
                Sign in will unlock saved projects, access control, and shared chat history.
                For now, chats save locally in your browser.
              </div>
            </div>
          </div>

          <div class="section-title"><h3>Live</h3></div>

          <div class="grid-cards">
            <article class="card" id="cardCompliance" role="button" tabindex="0">
              <div class="card-head">
                <div class="card-title">
                  <div class="icon">CG</div>
                  <div>
                    <h4>Compliance Guidance</h4>
                    <p>Ask anything. Raheem AI selects the most relevant guidance and answers logically with support.</p>
                  </div>
                </div>
                <span class="pill live">Live</span>
              </div>
              <div class="cta">
                <span class="pill brand" id="chipDoc2">Auto mode</span>
                <button class="btn primary" id="btnOpenChat" type="button">Start</button>
              </div>
            </article>

            <article class="card" id="cardRoadmap" role="button" tabindex="0">
              <div class="card-head">
                <div class="card-title">
                  <div class="icon">FF</div>
                  <div>
                    <h4>Future Features</h4>
                    <p>Early Design, structured reports, BIM review, energy compliance, and certification workflows.</p>
                  </div>
                </div>
                <span class="pill brand">Roadmap</span>
              </div>
              <div class="cta">
                <span class="pill brand">Preview roadmap</span>
                <button class="btn" id="btnOpenFuture" type="button" style="width:auto">View</button>
              </div>
            </article>
          </div>

          <div class="footer">
            <div class="footer-left">
              <span class="pill brand">Raheem AI</span>
              <span class="sep" aria-hidden="true"></span>
              <span>Built 2026</span>
              <span class="sep" aria-hidden="true"></span>
              <span>Abdulraheem Hayder Ahmed · C22310933 · TU Dublin · Architectural Technology</span>
            </div>
          </div>
        </section>

        <!-- FUTURE -->
        <section id="view-future" class="view">
          <div class="hero" style="margin-bottom:14px;">
            <h2>Future Features <span class="pill brand">Roadmap</span></h2>
            <p>
              Expanding Raheem AI into a full compliance and certification workflow.
              Outputs will be clear, structured, and verifiable.
            </p>
            <div class="quote">
              Move faster by knowing earlier. Reduce rework by catching risks before they become drawings.
            </div>
          </div>

          <div class="grid-cards">
            <article class="card">
              <div class="card-head">
                <div class="card-title">
                  <div class="icon">ED</div>
                  <div>
                    <h4>Early Design</h4>
                    <p>Enter areas and requirements. Generate basic layout options and refine the best direction.</p>
                  </div>
                </div>
                <span class="pill brand">Roadmap</span>
              </div>
              <div class="cta">
                <span class="pill brand">Example, 30m², 2 bed, kitchen</span>
                <button class="btn" type="button" style="width:auto">Preview</button>
              </div>
            </article>

            <article class="card">
              <div class="card-head">
                <div class="card-title">
                  <div class="icon">DAC</div>
                  <div>
                    <h4>DAC Report Generator</h4>
                    <p>Draft structured DAC reports aligned to guidance and project inputs, ready for review.</p>
                  </div>
                </div>
                <span class="pill brand">Roadmap</span>
              </div>
              <div class="cta">
                <span class="pill brand">Access and use</span>
                <button class="btn" type="button" style="width:auto">Preview</button>
              </div>
            </article>

            <!-- KEEP SPACE FOR MORE FUTURE FEATURES YOU ALREADY HAD -->
            <!-- If your old file had more cards, paste them here and they will match styling. -->
          </div>

          <div class="footer">
            <div class="footer-left">
              <span class="pill brand">Raheem AI</span>
              <span class="sep" aria-hidden="true"></span>
              <span>Built 2026</span>
              <span class="sep" aria-hidden="true"></span>
              <span>Abdulraheem Hayder Ahmed · C22310933 · TU Dublin · Architectural Technology</span>
            </div>
          </div>
        </section>

        <!-- CHAT -->
        <section id="view-chat" class="view">
          <div class="chat-shell">
            <div class="chat-top">
              <div>
                <strong>Chat</strong><br>
                <span id="chatSub">Auto mode, Raheem AI chooses the right guidance</span>
              </div>
              <button class="btn" id="btnBack" type="button" style="width:auto">Back</button>
            </div>

            <div class="chat-help">
              <button class="chip" type="button" data-prompt="What are the typical travel distance limits for an office?">Travel distance</button>
              <button class="chip" type="button" data-prompt="What are the key requirements for an accessible WC?">Accessible WC</button>
              <button class="chip" type="button" data-prompt="What are the main requirements for stair widths?">Stairs</button>
              <button class="chip" type="button" data-prompt="What is the difference between compartments and sub-compartments?">Compartmentation</button>
            </div>

            <div class="chat-log" id="chatLog"></div>

            <div class="chat-input">
              <textarea id="chatInput" placeholder="Type your message. Enter to send. Shift+Enter for a new line."></textarea>
              <button class="btn primary" id="btnSend" type="button" style="width:auto">Send</button>
            </div>
          </div>
        </section>

      </div>
    </main>
  </div>

  <script>
    const API_BASE = "https://complyr.onrender.com";

    // Views
    const viewDashboard = document.getElementById("view-dashboard");
    const viewFuture = document.getElementById("view-future");
    const viewChat = document.getElementById("view-chat");

    const navDashboard = document.getElementById("navDashboard");
    const navChat = document.getElementById("navChat");
    const navFuture = document.getElementById("navFuture");

    function setNavActive(which){
      navDashboard.classList.toggle("active", which === "dashboard");
      navChat.classList.toggle("active", which === "chat");
      navFuture.classList.toggle("active", which === "future");
    }

    function setBodyMode(which){
      document.body.classList.toggle("is-chat", which === "chat");
    }

    function showView(name){
      viewDashboard.classList.toggle("active", name === "dashboard");
      viewChat.classList.toggle("active", name === "chat");
      viewFuture.classList.toggle("active", name === "future");
      setNavActive(name);
      setBodyMode(name);
      if(name === "chat"){
        setTimeout(() => document.getElementById("chatInput").focus(), 40);
      }
    }

    function goDash(){ location.hash = "#/"; }
    function openChat(){ location.hash = "#/chat"; }
    function openFuture(){ location.hash = "#/future"; }

    function handleRoute(){
      const h = location.hash || "#/";
      if(h === "#/chat") showView("chat");
      else if(h === "#/future") showView("future");
      else showView("dashboard");
    }
    window.addEventListener("hashchange", handleRoute);
    handleRoute();

    navDashboard.addEventListener("click", goDash);
    navChat.addEventListener("click", openChat);
    navFuture.addEventListener("click", openFuture);

    document.getElementById("btnOpenChat").addEventListener("click", openChat);
    document.getElementById("btnBack").addEventListener("click", goDash);
    document.getElementById("btnOpenFuture").addEventListener("click", openFuture);

    document.getElementById("cardCompliance").addEventListener("click", openChat);
    document.getElementById("cardRoadmap").addEventListener("click", openFuture);

    // Docs panel
    const pdfCount = document.getElementById("pdfCount");
    const pdfSelect = document.getElementById("pdfSelect");
    const pdfSearch = document.getElementById("pdfSearch");
    const chatSub = document.getElementById("chatSub");
    const chipDoc = document.getElementById("chipDoc");
    const chipDoc2 = document.getElementById("chipDoc2");

    const serviceStatus = document.getElementById("serviceStatus");
    const lastSync = document.getElementById("lastSync");
    const syncInline = document.getElementById("syncInline");

    let allDocs = [];
    let activePdf = "";

    function setActivePdf(name){
      activePdf = name || "";
      const label = activePdf ? ("Pinned, " + activePdf) : "Auto mode";
      chatSub.textContent = activePdf ? ("Pinned document, " + activePdf) : "Auto mode, Raheem AI chooses the right guidance";
      chipDoc.textContent = label;
      chipDoc2.textContent = label;
      persistActiveChat();
      renderHistory();
    }

    function setSyncLabel(){
      const d = new Date();
      const t = d.toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});
      lastSync.textContent = "Updated " + t;
      syncInline.textContent = t;
    }

    function fillSelect(list){
      const current = activePdf;
      pdfSelect.innerHTML = "";
      const autoOpt = document.createElement("option");
      autoOpt.value = "";
      autoOpt.textContent = "Auto mode";
      pdfSelect.appendChild(autoOpt);

      const sorted = list.slice().sort((a,b)=>a.localeCompare(b, undefined, {sensitivity:"base"}));
      for(const name of sorted){
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        pdfSelect.appendChild(opt);
      }
      pdfSelect.value = current;
    }

    async function refreshDocs(){
      try{
        const r = await fetch(API_BASE + "/pdfs", { cache: "no-store" });
        if(!r.ok) throw new Error("bad");
        const data = await r.json();
        allDocs = Array.isArray(data.pdfs) ? data.pdfs : [];
        const count = (typeof data.count === "number") ? data.count : allDocs.length;

        pdfCount.textContent = "Docs " + count;

        serviceStatus.classList.remove("warn");
        serviceStatus.classList.add("ok");
        serviceStatus.innerHTML = '<span class="dot"></span>Service ready';

        setSyncLabel();
        fillSelect(allDocs);

        if(activePdf && !allDocs.includes(activePdf)){
          setActivePdf("");
          pdfSelect.value = "";
        }
      } catch(e){
        pdfCount.textContent = "Docs 0";
        serviceStatus.classList.remove("ok");
        serviceStatus.classList.add("warn");
        serviceStatus.innerHTML = '<span class="dot"></span>Service unavailable';
        pdfSelect.innerHTML = '<option value="">Auto mode</option>';
        setSyncLabel();
      }
    }

    pdfSelect.addEventListener("change", ()=> setActivePdf(pdfSelect.value));
    pdfSearch.addEventListener("input", ()=>{
      const q = pdfSearch.value.trim().toLowerCase();
      const filtered = !q ? allDocs : allDocs.filter(n => n.toLowerCase().includes(q));
      fillSelect(filtered);
      pdfSelect.value = activePdf;
    });

    refreshDocs();
    setInterval(refreshDocs, 9000);

    // Chat UI
    const chatLog = document.getElementById("chatLog");
    const chatInput = document.getElementById("chatInput");
    const btnSend = document.getElementById("btnSend");

    document.querySelectorAll("[data-prompt]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        chatInput.value = btn.getAttribute("data-prompt");
        chatInput.focus();
      });
    });

    // Streaming
    let activeStream = null;

    function stamp(){
      const d = new Date();
      return d.toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});
    }

    function stopActiveStream(){
      try{ if(activeStream){ activeStream.close(); activeStream = null; } }catch(e){}
    }

    function addMessageDom(role, text, time){
      const wrap = document.createElement("div");
      wrap.className = "msg " + (role === "user" ? "user" : "assistant");

      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.textContent = text || "";

      const meta = document.createElement("div");
      meta.className = "meta";
      meta.textContent = time || stamp();

      const container = document.createElement("div");
      container.appendChild(bubble);
      container.appendChild(meta);

      wrap.appendChild(container);
      chatLog.appendChild(wrap);
      chatLog.scrollTop = chatLog.scrollHeight;

      return {wrap, bubble, meta};
    }

    function setTyping(bubbleEl, on){
      if(!bubbleEl) return;
      if(on){
        bubbleEl.innerHTML = '';
        const span = document.createElement("span");
        span.className = "typing";
        span.textContent = "Typing";
        const dots = document.createElement("span");
        dots.className = "dots";
        dots.innerHTML = "<span></span><span></span><span></span>";
        span.appendChild(dots);
        bubbleEl.appendChild(span);
      } else {
        bubbleEl.textContent = "";
      }
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    function buildStreamUrl(question){
      const params = new URLSearchParams();
      params.set("q", question);

      if(activePdf){
        params.set("pdf", activePdf);
        params.set("force_docs", "true");
      }
      return API_BASE + "/ask_stream?" + params.toString();
    }

    // Local chat history (improved naming)
    const STORAGE_KEY = "raheem_ai_chats_v4";
    let chats = [];
    let activeChatId = null;

    function loadChats(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        chats = raw ? JSON.parse(raw) : [];
        if(!Array.isArray(chats)) chats = [];
      } catch(e){ chats = []; }
    }
    function saveChats(){
      try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(chats)); } catch(e){}
    }

    function cleanTitle(s){
      const t = (s || "").trim().replace(/\s+/g," ");
      if(!t) return "";
      return t.length > 42 ? (t.slice(0,42) + "…") : t;
    }

    function newChatTitle(){
      // Session numbering, clean and sellable
      const n = (chats?.length || 0) + 1;
      return "Session " + n;
    }

    function createChat(){
      const id = "c_" + Math.random().toString(16).slice(2) + Date.now().toString(16);
      const chat = { id, title: newChatTitle(), createdAt: Date.now(), updatedAt: Date.now(), forcedPdf: activePdf || "", messages: [] };
      chats.unshift(chat);
      activeChatId = id;
      saveChats();
      renderHistory();
      renderActiveChat();
      return chat;
    }

    function getActiveChat(){ return chats.find(c => c.id === activeChatId) || null; }

    function setActiveChat(id){
      const c = chats.find(x => x.id === id);
      if(!c) return;
      activeChatId = id;

      if(c.forcedPdf && allDocs.includes(c.forcedPdf)){
        setActivePdf(c.forcedPdf);
        pdfSelect.value = c.forcedPdf;
      } else {
        setActivePdf("");
        pdfSelect.value = "";
      }

      renderHistory();
      renderActiveChat();
    }

    function persistActiveChat(){
      const c = getActiveChat();
      if(!c) return;
      c.updatedAt = Date.now();
      c.forcedPdf = activePdf || "";
      saveChats();
    }

    function addMsgToChat(role, text){
      const c = getActiveChat();
      if(!c) return;

      // auto-title after first user message if still "Session X"
      if(role === "user" && /^Session\s\d+$/.test(c.title || "")){
        const candidate = cleanTitle(text);
        if(candidate) c.title = candidate;
      }

      c.messages.push({ role, text: text || "", time: stamp() });
      c.updatedAt = Date.now();
      c.forcedPdf = activePdf || "";
      saveChats();
      renderHistory();
    }

    function lastMeaningfulPreview(chat){
      const arr = chat.messages || [];
      for(let i = arr.length - 1; i >= 0; i--){
        const t = (arr[i].text || "").trim();
        if(t) return t;
      }
      return "No messages yet.";
    }

    function formatSmallTime(ts){
      const d = new Date(ts);
      return d.toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    const historyList = document.getElementById("historyList");
    const btnNewChat = document.getElementById("btnNewChat");
    const btnClearChats = document.getElementById("btnClearChats");

    function renderHistory(){
      historyList.innerHTML = "";
      if(!chats.length){
        const empty = document.createElement("div");
        empty.className = "history-item";
        empty.style.cursor = "default";
        empty.innerHTML = '<div class="history-name">No saved chats yet</div><div class="history-preview">Start a chat and it will appear here.</div>';
        historyList.appendChild(empty);
        return;
      }
      for(const c of chats){
        const item = document.createElement("div");
        item.className = "history-item" + (c.id === activeChatId ? " active" : "");
        item.tabIndex = 0;

        const preview = lastMeaningfulPreview(c);
        const meta = formatSmallTime(c.updatedAt || c.createdAt);

        item.innerHTML = `
          <div class="history-row">
            <div class="history-name">${escapeHtml(c.title || "Session")}</div>
            <div class="history-meta">${meta}</div>
          </div>
          <div class="history-preview">${escapeHtml(preview)}</div>
          <div class="history-controls">
            <button class="history-btn" data-act="open" data-id="${c.id}">Open</button>
            <button class="history-btn" data-act="rename" data-id="${c.id}">Rename</button>
            <button class="history-btn" data-act="delete" data-id="${c.id}">Delete</button>
          </div>
        `;

        item.addEventListener("click", (e)=>{
          const btn = e.target.closest("button");
          if(btn){
            const act = btn.getAttribute("data-act");
            const id = btn.getAttribute("data-id");
            if(act === "open") setActiveChat(id);
            if(act === "rename") renameChat(id);
            if(act === "delete") deleteChat(id);
            return;
          }
          setActiveChat(c.id);
        });

        item.addEventListener("keydown", (e)=>{
          if(e.key === "Enter" || e.key === " "){
            e.preventDefault();
            setActiveChat(c.id);
          }
        });

        historyList.appendChild(item);
      }
    }

    function renameChat(id){
      const c = chats.find(x => x.id === id);
      if(!c) return;
      const name = prompt("Rename chat", c.title || "Session");
      if(name === null) return;
      const cleaned = (name || "").trim();
      if(!cleaned) return;
      c.title = cleanTitle(cleaned) || c.title;
      c.updatedAt = Date.now();
      saveChats();
      renderHistory();
    }

    function deleteChat(id){
      const c = chats.find(x => x.id === id);
      if(!c) return;
      if(!confirm("Delete this chat?")) return;
      chats = chats.filter(x => x.id !== id);
      if(activeChatId === id){
        activeChatId = chats.length ? chats[0].id : null;
      }
      saveChats();
      renderHistory();
      renderActiveChat();
    }

    function clearAllChats(){
      if(!confirm("Clear all saved chats? This cannot be undone.")) return;
      chats = [];
      activeChatId = null;
      saveChats();
      renderHistory();
      renderActiveChat();
    }

    btnNewChat.addEventListener("click", ()=>{ createChat(); openChat(); });
    btnClearChats.addEventListener("click", clearAllChats);

    function renderActiveChat(){
      chatLog.innerHTML = "";
      const c = getActiveChat();
      if(!c){
        const created = createChat();
        created.messages.push({
          role: "assistant",
          text: "Hey. Talk to me normally. If your question turns into regs or compliance, I’ll switch automatically and keep it readable.",
          time: stamp()
        });
        saveChats();
        renderHistory();
        renderActiveChat();
        return;
      }
      for(const m of (c.messages || [])){
        addMessageDom(m.role, m.text, m.time);
      }
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    loadChats();
    if(chats.length) activeChatId = chats[0].id;
    renderHistory();
    renderActiveChat();

    async function send(){
      const raw = chatInput.value.trim();
      if(!raw) return;

      stopActiveStream();
      addMsgToChat("user", raw);
      renderActiveChat();
      chatInput.value = "";

      const timeNow = stamp();
      const assistantDom = addMessageDom("assistant", "", timeNow);
      setTyping(assistantDom.bubble, true);

      const url = buildStreamUrl(raw);

      let buffer = "";
      let gotAnyText = false;
      let finished = false;

      try{
        activeStream = new EventSource(url);

        activeStream.onmessage = (e) => {
          const chunk = (e.data || "").replaceAll("\\n", "\n");
          if(!gotAnyText){
            gotAnyText = true;
            setTyping(assistantDom.bubble, false);
          }
          buffer += chunk;
          assistantDom.bubble.textContent = buffer;
          chatLog.scrollTop = chatLog.scrollHeight;
        };

        activeStream.addEventListener("done", () => {
          finished = true;
          stopActiveStream();
          const finalText = (buffer || "").trim() || "No response available.";
          assistantDom.bubble.textContent = finalText;
          addMsgToChat("assistant", finalText);
          persistActiveChat();
          renderHistory();
        });

        activeStream.addEventListener("error", () => {
          if(finished) return;

          setTimeout(() => {
            if(finished) return;

            if(gotAnyText){
              finished = true;
              stopActiveStream();
              const finalText = (buffer || "").trim() || "No response available.";
              assistantDom.bubble.textContent = finalText;
              addMsgToChat("assistant", finalText);
              persistActiveChat();
              renderHistory();
              return;
            }

            stopActiveStream();
            setTyping(assistantDom.bubble, false);
            const msg = "The service is currently unavailable. Please try again in a moment.";
            assistantDom.bubble.textContent = msg;
            addMsgToChat("assistant", msg);
          }, 350);
        });

      } catch(err){
        stopActiveStream();
        setTyping(assistantDom.bubble, false);
        const msg = "The service is currently unavailable. Please try again in a moment.";
        assistantDom.bubble.textContent = msg;
        addMsgToChat("assistant", msg);
      }
    }

    btnSend.addEventListener("click", send);
    chatInput.addEventListener("keydown", (e)=>{
      if(e.key === "Enter" && !e.shiftKey){
        e.preventDefault();
        send();
      }
    });

    // keep pdf pin in sync with history
    function setActivePdfSafe(v){
      setActivePdf(v);
      pdfSelect.value = v || "";
    }

    // Particle background (visible motion)
    (function(){
      const canvas = document.getElementById("particles");
      const ctx = canvas.getContext("2d");
      let w=0,h=0, dpr=1;
      let particles = [];
      const COUNT = 64;

      function resize(){
        dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
        w = canvas.width = Math.floor(window.innerWidth * dpr);
        h = canvas.height = Math.floor(window.innerHeight * dpr);
        canvas.style.width = window.innerWidth + "px";
        canvas.style.height = window.innerHeight + "px";
      }

      function rand(a,b){ return a + Math.random()*(b-a); }

      function init(){
        particles = [];
        for(let i=0;i<COUNT;i++){
          particles.push({
            x: rand(0,w),
            y: rand(0,h),
            r: rand(1.2, 2.8) * dpr,
            vx: rand(-0.18, 0.18) * dpr,
            vy: rand(-0.12, 0.12) * dpr,
            a: rand(0.18, 0.55)
          });
        }
      }

      function draw(){
        ctx.clearRect(0,0,w,h);

        // dots
        for(const p of particles){
          p.x += p.vx;
          p.y += p.vy;

          if(p.x < -20) p.x = w+20;
          if(p.x > w+20) p.x = -20;
          if(p.y < -20) p.y = h+20;
          if(p.y > h+20) p.y = -20;

          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);

          // alternate between mint and blue softly
          const c = (p.x / w) > 0.5 ? `rgba(108,182,255,${p.a})` : `rgba(85,247,214,${p.a})`;
          ctx.fillStyle = c;
          ctx.fill();
        }

        // faint connecting lines
        for(let i=0;i<particles.length;i++){
          for(let j=i+1;j<particles.length;j++){
            const a = particles[i], b = particles[j];
            const dx = a.x - b.x, dy = a.y - b.y;
            const dist = Math.sqrt(dx*dx + dy*dy);
            const max = 140 * dpr;
            if(dist < max){
              const alpha = (1 - dist/max) * 0.10;
              ctx.strokeStyle = `rgba(255,255,255,${alpha})`;
              ctx.lineWidth = 1 * dpr;
              ctx.beginPath();
              ctx.moveTo(a.x, a.y);
              ctx.lineTo(b.x, b.y);
              ctx.stroke();
            }
          }
        }

        requestAnimationFrame(draw);
      }

      window.addEventListener("resize", ()=>{
        resize();
        init();
      });

      resize();
      init();
      draw();
    })();

  </script>
</body>
</html>
